<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Admin - Kritik Saran</title>
  <link rel="stylesheet" href="admin-dashboard.css" />
  <style>
    .status-pending { background-color: #fff3cd; color: #856404; padding: 4px 8px; border-radius: 4px; font-weight: bold; font-size: 0.8rem; }
    .status-done { background-color: #d4edda; color: #155724; padding: 4px 8px; border-radius: 4px; font-weight: bold; font-size: 0.8rem; }
    .btn-small { padding: 5px 10px; font-size: 0.9rem; border: none; border-radius: 4px; cursor: pointer; margin-right: 5px; color: white; }
    .btn-check { background-color: #28a745; }
    .btn-del { background-color: #dc3545; }
    
    /* Layout Tabel Khusus Pesan Panjang */
    td.msg-col { max-width: 300px; word-wrap: break-word; }
  </style>
</head>
<body>
  <div class="admin-container">
    <aside class="sidebar">
      <div class="sidebar-header">
        <h2>ðŸ”§ ADMIN PANEL</h2>
      </div>
      <nav>
        <ul>
          <li><a href="admin-dashboard.html">ðŸ“Š Dashboard</a></li>
          <li><a href="admin-pesanan.html">ðŸ§¾ Kelola Pesanan</a></li>
          <li><a href="admin-status.html">ðŸšš Status Pengiriman</a></li>
          <li><a href="admin-feedback.html" class="active">ðŸ’¬ Kritik & Saran</a></li>
          <li><a href="admin-pelanggan.html">ðŸ‘¥ Data Pelanggan</a></li>
          <li><a href="admin-laporan.html">ðŸ“ˆ Laporan</a></li>
          <li><a href="index.html">ðŸšª Logout</a></li>
        </ul>
      </nav>
    </aside>

    <main class="main-content">
      <header class="topbar">
        <h1>ðŸ’¬ Manajemen Kritik & Saran</h1>
        <p>Kelola masukan dari pelanggan (Local Storage)</p>
      </header>

      <section class="tabel-terbaru">
        <table>
          <thead>
            <tr>
              <th>Tanggal</th>
              <th>Nama</th>
              <th>Kategori</th>
              <th>Pesan</th>
              <th>Status</th>
              <th>Aksi</th>
            </tr>
          </thead>
          <tbody id="feedbackTableBody">
            </tbody>
        </table>
      </section>
    </main>
  </div>

  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const STORAGE_KEY = "MRKLIN_FEEDBACK_DATA";
      const tableBody = document.getElementById("feedbackTableBody");

      function renderTable() {
        const data = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
        tableBody.innerHTML = "";

        if (data.length === 0) {
          tableBody.innerHTML = `<tr><td colspan="6" style="text-align:center; padding: 20px;">Belum ada kritik masuk.</td></tr>`;
          return;
        }

        data.slice().reverse().forEach((item, index) => {
          const realIndex = data.length - 1 - index; // Balik urutan index

          const row = document.createElement("tr");
          
          const statusBadge = item.status === "Selesai" 
            ? `<span class="status-done">Selesai</span>` 
            : `<span class="status-pending">Pending</span>`;

          const actionBtns = `
            <button class="btn-small btn-check" onclick="markDone(${realIndex})" title="Tandai Selesai">âœ”</button>
            <button class="btn-small btn-del" onclick="deleteItem(${realIndex})" title="Hapus">ðŸ—‘</button>
          `;

          row.innerHTML = `
            <td>${item.date}</td>
            <td><strong>${item.name}</strong></td>
            <td>${item.category}</td>
            <td class="msg-col">${item.message}</td>
            <td>${statusBadge}</td>
            <td>${actionBtns}</td>
          `;
          tableBody.appendChild(row);
        });
      }

      window.markDone = (index) => {
        const data = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
        if (data[index].status !== "Selesai") {
          data[index].status = "Selesai";
          localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
          renderTable();
        }
      };

      window.deleteItem = (index) => {
        if (confirm("Hapus kritik ini?")) {
          const data = JSON.parse(localStorage.getItem(STORAGE_KEY)) || [];
          data.splice(index, 1);
          localStorage.setItem(STORAGE_KEY, JSON.stringify(data));
          renderTable();
        }
      };

      renderTable();
    });
  </script>
</body>
</html>